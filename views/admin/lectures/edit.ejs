<%- include('../partials/_header') %>
    <div class="row">
        <div class="col-12">
            <div class="card rounded-0 min-vh-100">
                <div class="card-body">
                    <h4 class="card-title">Edit Lecture</h4>
                    <form action="/admin/lectures/<%= lecture.id %>/update" method="POST">
                        <div class="form-group  mb-4">
                            <label for="course_id">Course</label>
                            <div class="position-relative">
                                <input type="search" name="course_id" id="course_id" class="form-control"
                                    placeholder="Search Course by Title" value="<%= lecture.course_id %>" autocomplete="off" required>
                                <div id="courseList" class="list-group position-absolute w-100"
                                    style="z-index: 1000; max-height: 200px; overflow-y: auto;">
                                </div>
                            </div>
                        </div>
                        <div class="form-group  mb-4">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" name="title"
                                placeholder="Enter lecture title" value="<%= lecture.title %>" required>
                        </div>
                        <div class="form-group  mb-4">
                            <label for="start_page">Start Page</label>
                            <input type="number" class="form-control" id="start_page" name="start_page" value="<%= lecture.start_page %>" required>
                        </div>
                        <div class="form-group  mb-4">
                            <label for="end_page">End Page</label>
                            <input type="number" class="form-control" id="end_page" name="end_page" value="<%= lecture.end_page %>" required>
                        </div>
                        <div class="col-12 mb-4">
                            <button type="submit" class="btn btn-primary">
                               Update
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
  const course_idInput = document.getElementById('course_id');
  const courseList = document.getElementById('courseList');

  course_idInput.addEventListener('input', async function () {
    const query = this.value.trim();
    if (!query) {
      courseList.innerHTML = '';
      return;
    }

    try {
      const response = await fetch(`/courses/search?query=${encodeURIComponent(query)}`);
      const courses = await response.json();

      courseList.innerHTML = '';

      if (courses.length === 0) {
        const noItem = document.createElement('li');
        noItem.classList.add('list-group-item', 'text-muted');
        noItem.textContent = 'No courses found';
        courseList.appendChild(noItem);
        return;
      }

      courses.forEach(course => {
        const listItem = document.createElement('li');
        listItem.classList.add('list-group-item', 'list-group-item-action', 'cursor-pointer', 'text-dark');
        listItem.textContent = `${course.id} - ${course.title}`;

        // When user clicks a result
        listItem.addEventListener('click', () => {
          course_idInput.value = course.id; // set ID as the value
          courseList.innerHTML = '';        // hide list
        });

        courseList.appendChild(listItem);
      });
    } catch (error) {
      console.error('Error fetching courses:', error);
    }
  });

  // Optional: hide list if user clicks outside
  document.addEventListener('click', (e) => {
    if (!courseList.contains(e.target) && e.target !== course_idInput) {
      courseList.innerHTML = '';
    }
  });
</script>

    
<%- include('../partials/_footer') %>