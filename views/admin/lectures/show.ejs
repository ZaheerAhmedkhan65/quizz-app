<%- include('../partials/_header') %>
<div class="row ">
    <div class="col-12">
        <div class="card rounded-0">
            <div class="card-body">
                <h4 class="card-title"><%= lecture.title %></h4>
                <a href="<%= course.handout_pdf %>" class="text-decoration-none text-muted fw-semibold" download>Download <%= course.handout_original_filename %></a>
                <hr>
                <h4 class="card-title m-0">Questions</h4>
                <% if(questions.length> 0) { %>
                  <ul id="questions-container" class="list-group overflow-auto">
                    <% questions.forEach((question, index)=> { %>
                      <li class="card list-group-item mb-4 bg-transparent border-0 px-0">
                        <div class="card-body p-0">
                          <div id="question_<%= question.id %>" class="card-title py-3 d-flex align-items-center justify-content-between m-0">
                            <strong class="w-100 d-flex align-items-center gap-1">
                              <span id="question-index-container-<%= question.id %>">
                                  <%=index+1%> :
                              </span>
                              <span data-text="question-text" id="question-text-<%= question.id %>">
                                  <%= question.question_text %>
                              </span>
                            </strong>
                            <div class="btn-group dropup">
                              <button type="button" class="bg-transparent border-0" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-three-dots-vertical"></i>
                              </button>
                              <ul class="dropdown-menu">
                                <li class="dropdown-item edit-question-btn" data-question-id="<%= question.id %>">Edit</li>
                                  <li class="dropdown-item text-danger">
                                    <form class="delete-question" data-question-id="<%= question.id %>"
                                        action="/admin/questions/<%= question.id %>/delete"
                                        method="delete">
                                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                    </form>
                                  </li>
                              </ul>
                            </div>
                          </div>
                          <ul class="list-group" id="options-container-<%= question.id %>">
                            <% question.options.forEach(option=> { %>
                              <li class="list-group-item border-0 d-flex align-items-center gap-1 px-0 bg-transparent">
                                <input type="radio" name="question_<%= question.id %>"
                                  id="option_<%= option.id %>" value="<%= option.option_text %>"
                                  class="form-check-input">
                                <label for="option_<%= option.id %>" class="w-100 d-flex align-items-center gap-1">
                                    <%= option.option_text %>
                                    <%= option.is_correct ? '(Correct)' : '' %>
                                </label>
                                <div class="btn-group dropup">
                                  <button type="button" class="bg-transparent border-0" data-bs-toggle="dropdown"
                                      aria-expanded="false">
                                      <i class="bi bi-three-dots-vertical"></i>
                                  </button>
                                  <ul class="dropdown-menu">
                                      <li class="dropdown-item edit-option-btn"
                                          data-option-id="<%= option.id %>">
                                          Edit</li>
                                      <li class="dropdown-item text-danger">
                                          <form class="delete-option" data-option-id="<%= option.id %>"
                                              action="/admin/options/<%= option.id %>/delete"
                                              method="delete">
                                              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                          </form>
                                      </li>
                                  </ul>
                                </div>
                              </li>
                            <% }) %>
                          </ul>
                          <% if (question.options.length <=3) { %>
                            <form class="option-form"
                              action="/admin/questions/<%= question.id %>/options/create"
                              method="post">
                              <input type="text" name="option_text" class="form-control mt-3"
                                  placeholder="Enter Option text" required>
                              <select name="is_correct" class="form-select mt-3">
                                  <option value="0">Incorrect</option>
                                  <option value="1">Correct</option>
                              </select>
                              <div class="text-end mb-2">
                                  <button type="submit" class="btn btn-sm btn-primary mt-3">Add Option</button>
                              </div>
                            </form>
                          <% } %>
                        </div>
                      </li>
                      <hr class="m-0">
                    <% }) %>
                  </ul>
                <% } else { %>
                    <p>No questions have been created for this quiz.</p>
                    <ul id="questions-container" class="list-group overflow-auto rounded-0"
                        style="height: 100%; padding-bottom: 130px;"></ul>
                <% } %>
              </div>
            </div>
          </div>
        </div>
<div class="row bg-dark">
  <div class="col-6 mx-auto">
    <form id="question-form" action="/admin/questions/create" method="post">
      <input type="text" name="question_text" id="question-text" class="form-control mt-3"
        placeholder="Write Question text here" required>
      <input type="text" name="lecture_id" id="lecture-id" value="<%= lecture.id %>" hidden>
      <div class="text-end mb-2">
        <button type="submit" class="btn btn-sm btn-primary mt-3">Create</button>
      </div>
    </form>
  </div>
</div>
<script src="/js/createQuestionAndOptions.js"></script>
<script src="/js/editAndDeleteQuestion.js"></script>
<%- include('../partials/_footer') %>